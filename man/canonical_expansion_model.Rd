% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/calc_canex.R
\encoding{UTF-8}
\name{canonical_expansion_model}
\alias{canonical_expansion_model}
\title{Modelo de Expansión Canónica para Distribuciones de Exposición a Medios}
\usage{
canonical_expansion_model(
  marginal_probs,
  correlations,
  insertions,
  population = 1e+07,
  truncation_order = 2,
  tolerance = 1e-10
)
}
\arguments{
\item{marginal_probs}{Vector numérico con las probabilidades marginales de exposición por vehículo}

\item{correlations}{Matriz numérica de correlaciones}

\item{insertions}{Vector numérico con el número de inserciones por vehículo}

\item{population}{Tamaño de la población objetivo (por defecto 1000000)}

\item{truncation_order}{Orden de truncación para la expansión canónica (por defecto 2).
Controla cuántos términos de la expansión se incluyen en el cálculo.}

\item{tolerance}{Tolerancia numérica para validaciones}

\item{vehicle_data}{DataFrame con datos de vehículos}
}
\value{
Una lista de clase "reach_canonical" conteniendo:
\itemize{
\item reach: Lista con la cobertura:
\itemize{
\item porcentaje: Cobertura neta en porcentaje
\item personas: Cobertura neta en número de personas
}
\item distribucion: Lista con la distribución de contactos:
\itemize{
\item porcentaje: Vector con probabilidad de cada número de exposiciones
\item personas: Vector con número de personas para cada número de exposiciones
}
\item acumulada: Lista con la distribución acumulada:
\itemize{
\item porcentaje: Vector con probabilidades acumuladas
\item personas: Vector con personas alcanzadas al menos N veces
}
\item parametros: Lista con parámetros del modelo:
\itemize{
\item probabilidad_media: Media de las probabilidades marginales
\item correlaciones: Matriz de correlaciones entre soportes
\item inserciones: Vector de inserciones por soporte
\item prob_cero_contactos: Probabilidad de no exposición
\item grps: Gross Rating Points totales
\item bbd_params: Parámetros de las distribuciones Beta-Binomial para cada soporte
}
}

Lista con validación y DataFrame de correlaciones únicas
Validación y ordenamiento de inputs principales

Lista con datos validados y ordenados
Cálculo de parámetros BBD

Lista de parámetros BBD por vehículo
Cálculo de matriz canónica

Matriz de variables canónicas normalizadas
Cálculo de probabilidad conjunta

Probabilidad conjunta para un patrón de exposición
Genera todos los patrones posibles de exposición
}
\description{
Implementa el modelo de expansión canónica desarrollado por Danaher (1991) para
calcular la distribución de contactos en planes de medios con múltiples inserciones por soporte.
El modelo considera las correlaciones entre soportes y permite estimar la cobertura y distribución
de contactos de manera más precisa que los modelos tradicionales al incorporar las dependencias
entre exposiciones.
}
\details{
El modelo de expansión canónica calcula:
\enumerate{
\item Distribución conjunta de exposiciones considerando correlaciones entre soportes
\item Distribución de contactos para cada nivel de exposición
\item Métricas agregadas como cobertura total y GRPs
}

El proceso incluye:
\itemize{
\item Validación exhaustiva de inputs:
\itemize{
\item Verificación de dimensiones y consistencia entre inputs
\item Validación de rangos (probabilidades entre 0 y 1)
\item Verificación de matriz de correlaciones (simetría, semidefinida positiva)
\item Control de tipos de datos y valores permitidos
}
\item Cálculo de variables canónicas según ecuaciones 2 y 3 del paper original
\item Estimación de medias y varianzas para las distribuciones BBD marginales
\item Cálculo de probabilidades conjuntas según ecuación 6
\item Agregación de resultados en distribuciones de contactos y métricas
}

La precisión numérica del modelo se controla mediante el parámetro tolerance,
que afecta tanto a las validaciones como a los cálculos internos.
}
\examples{
# Ejemplo básico con tres soportes
marginal_probs <- c(0.25, 0.20, 0.15)
correlations <- matrix(
  c(1.000, 0.085, 0.075,
    0.085, 1.000, 0.080,
    0.075, 0.080, 1.000),
  nrow = 3,
  byrow = TRUE
)
insertions <- c(8, 6, 4)
population <- 1000000

# Ejemplo con parámetros por defecto
resultados <- canonical_expansion_model(
  marginal_probs = marginal_probs,
  correlations = correlations,
  insertions = insertions,
  population = population
)

# Ejemplo con parámetros adicionales de control
resultados_precision <- canonical_expansion_model(
  marginal_probs = marginal_probs,
  correlations = correlations,
  insertions = insertions,
  population = population,
  truncation_order = 2,
  tolerance = 1e-10
)

# Examinar los resultados
print(resultados)

# Ejemplo con validación de datos
\dontrun{
# Matriz de correlaciones inválida
correlations_invalidas <- matrix(
  c(1.000, 0.085, 0.075,
    0.085, 1.000),
  nrow = 2,
  byrow = TRUE
)
resultados <- canonical_expansion_model(
  marginal_probs = marginal_probs,
  correlations = correlations_invalidas,
  insertions = insertions
)
# Generará un error por dimensiones incorrectas

# Probabilidades marginales inválidas
probs_invalidas <- c(1.2, 0.2, 0.15)
resultados <- canonical_expansion_model(
  marginal_probs = probs_invalidas,
  correlations = correlations,
  insertions = insertions
)
# Generará un error por probabilidades fuera de rango
}

}
\references{
Danaher, P. J. (1991). A canonical expansion model for multivariate media exposure distributions:
A generalization of the Duplication of Viewing Law. Journal of Marketing Research, 28(3), 361-367.
}
\seealso{
\code{\link{calc_sainsbury}} para estimaciones con duplicación aleatoria
\code{\link{calc_binomial}} para estimaciones con la distribución Binomial
\code{\link{calc_beta_binomial}} para estimaciones con la distribución Beta-Binomial
\code{\link{calc_metheringham}} para estimaciones con la distribución de Metheringham
\code{\link{calc_hofmans}} para estimaciones con la distribución de Hofmans
Valida y extrae correlaciones únicas de una matriz de correlaciones
}
