% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/calc_plan_modelos.R, R/calc_plan_modelos_2.R
\encoding{UTF-8}
\name{optimize_media_plan}
\alias{optimize_media_plan}
\title{Optimización de planes de medios con restricciones mediante procesamiento por lotes}
\usage{
optimize_media_plan(
  soportes_df,
  FEM,
  objetivo_cobertura,
  presupuesto_max,
  tolerancia_presupuesto = 0.1,
  poblacion_total = 4.7e+07,
  tam_batch = 5,
  soportes_vetados = NULL,
  modelo = c("sainsbury", "binomial", "canex"),
  usar_audiencia_util = FALSE,
  correlaciones = NULL,
  truncation_order = 2
)

optimize_media_plan(
  soportes_df,
  FEM,
  objetivo_cobertura,
  presupuesto_max,
  tolerancia_presupuesto = 0.1,
  poblacion_total = 4.7e+07,
  tam_batch = 5,
  soportes_vetados = NULL,
  modelo = c("sainsbury", "binomial", "canex"),
  usar_audiencia_util = FALSE,
  correlaciones = NULL,
  truncation_order = 2
)
}
\arguments{
\item{soportes_df}{Data frame con columnas: soportes (character), audiencias (numeric), tarifas (numeric).
Si se usa audiencia útil, debe incluir también indices_utilidad (numeric)}

\item{FEM}{Frecuencia Efectiva Mínima requerida (número entero positivo)}

\item{objetivo_cobertura}{Cobertura objetivo a alcanzar (porcentaje)}

\item{presupuesto_max}{Presupuesto máximo disponible}

\item{tolerancia_presupuesto}{Desviación permitida sobre el presupuesto máximo (por defecto 0.10 = 10\%)}

\item{poblacion_total}{Tamaño de la población objetivo (por defecto 47000000)}

\item{tam_batch}{Tamaño de los lotes para procesamiento (por defecto 5)}

\item{soportes_vetados}{Vector de caracteres con nombres de soportes a excluir (opcional)}

\item{modelo}{Modelo a utilizar: "sainsbury", "binomial" o "canex" (por defecto "sainsbury")}

\item{usar_audiencia_util}{Logical indicando si usar audiencia útil (TRUE) o bruta (FALSE, por defecto)}

\item{correlaciones}{Matriz de correlaciones entre soportes (requerida solo para modelo "canex")}

\item{truncation_order}{Orden de truncación para el modelo de expansión canónica (por defecto 2)}
}
\value{
Una lista conteniendo:
\itemize{
\item exito: Logical indicando si se encontró solución factible
\item cobertura_alcanzada: Porcentaje de cobertura logrado
\item coste_total: Coste total del plan
\item soportes_seleccionados: Data frame con los soportes del plan óptimo. Si se usa audiencia útil,
incluye columnas adicionales para audiencia útil e índices de utilidad
\item plan_completo: Vector binario indicando soportes seleccionados
\item objetivo_alcanzado: Logical indicando si se alcanzó el objetivo
\item distribucion: Lista con distribución de contactos y acumulada
\item soportes_vetados: Vector de soportes excluidos encontrados
\item soportes_no_encontrados: Vector de soportes vetados no localizados
}

Una lista conteniendo:
\itemize{
\item exito: Logical indicando si se encontró solución factible
\item cobertura_alcanzada: Porcentaje de cobertura logrado
\item coste_total: Coste total del plan
\item soportes_seleccionados: Data frame con los soportes del plan óptimo
\item plan_completo: Vector binario indicando soportes seleccionados
\item objetivo_alcanzado: Logical indicando si se alcanzó el objetivo
\item evaluacion: Lista con evaluaciones de presupuesto, cobertura y FEM
\item distribucion: Lista con distribución de contactos y acumulada
\item soportes_vetados: Vector de soportes excluidos
\item tipo_audiencia: Tipo de audiencia usada ("bruta" o "util")
\item modelo_usado: Modelo utilizado para los cálculos
}
}
\description{
Implementa un algoritmo de optimización para encontrar la combinación óptima de soportes publicitarios
que maximiza la cobertura para una Frecuencia Efectiva Mínima (FEM) determinada, respetando restricciones presupuestarias.
El algoritmo utiliza un enfoque de procesamiento por lotes (batches) y permite elegir entre el modelo de Sainsbury o el Binomial
para el cálculo de coberturas y distribución de contactos. Permite la exclusión de soportes específicos y maneja restricciones
presupuestarias con tolerancia configurable. Adicionalmente, permite trabajar con audiencias brutas o audiencias útiles
(considerando índices de utilidad).

Implementa un algoritmo de optimización para encontrar la combinación óptima de soportes publicitarios
que maximiza la cobertura para una Frecuencia Efectiva Mínima (FEM) determinada, respetando restricciones presupuestarias.
El algoritmo utiliza un enfoque de procesamiento por lotes (batches) y permite elegir entre el modelo de Sainsbury,
Binomial o Expansión Canónica para el cálculo de coberturas y distribución de contactos.
}
\details{
El algoritmo de optimización sigue los siguientes pasos:
\enumerate{
\item Preprocesamiento de datos:
\itemize{
\item Filtrado de soportes vetados
\item Cálculo de audiencias útiles si corresponde (audiencia * índice_utilidad)
\item Cálculo de ratios de eficiencia (audiencia/tarifa o audiencia útil/tarifa)
\item Ordenación por eficiencia
}
\item Procesamiento por lotes:
\itemize{
\item División en batches para optimizar el proceso
\item Evaluación de combinaciones que cumplen FEM mínima
\item Verificación de restricción presupuestaria
\item Cálculo de cobertura mediante el modelo seleccionado
}
\item Optimización iterativa:
\itemize{
\item Búsqueda de mejores soluciones en cada batch
\item Actualización progresiva de la mejor solución
\item Criterio de parada por objetivo alcanzado
}
}

Los modelos disponibles son:
\itemize{
\item Sainsbury: Considera la duplicación entre soportes como el producto de las probabilidades individuales
\item Binomial: Asume una probabilidad media de exposición para todos los soportes
}

El algoritmo de optimización sigue los siguientes pasos:
\enumerate{
\item Preprocesamiento de datos:
\itemize{
\item Filtrado de soportes vetados
\item Cálculo de audiencias útiles si corresponde
\item Cálculo de ratios de eficiencia
\item Validación de matriz de correlaciones para modelo canex
}
\item Procesamiento por lotes:
\itemize{
\item División en batches para optimizar el proceso
\item Evaluación de combinaciones que cumplen FEM mínima
\item Verificación de restricción presupuestaria
\item Cálculo de cobertura mediante el modelo seleccionado
}
}

Los modelos disponibles son:
\itemize{
\item Sainsbury: Considera la duplicación entre soportes como producto de probabilidades
\item Binomial: Asume una probabilidad media de exposición para todos los soportes
\item Canex: Modelo de expansión canónica que considera correlaciones entre soportes
}
}
\examples{
# Ejemplo con audiencia bruta y modelo Sainsbury

datos <- readr::read_csv(file = "data.csv", show_col_types = FALSE)

resultado_bruto <- optimize_media_plan(
  soportes_df = datos,
  FEM = 2,
  objetivo_cobertura = 50,
  presupuesto_max = 100000,
  modelo = "sainsbury",
  usar_audiencia_util = FALSE
)

# Ejemplo con audiencia útil y modelo Binomial
datos_util <- data.frame(
  soportes = c("Medio1", "Medio2", "Medio3"),
  audiencias = c(1000000, 800000, 600000),
  tarifas = c(50000, 40000, 30000),
  indices_utilidad = c(1.2, 1.1, 0.9)
)

resultado_util <- optimize_media_plan(
  soportes_df = datos_util,
  FEM = 2,
  objetivo_cobertura = 50,
  presupuesto_max = 100000,
  modelo = "binomial",
  usar_audiencia_util = TRUE
)

# Datos de ejemplo
example_data <- data.frame(
  soportes = c("Medio1", "Medio2", "Medio3"),
  audiencias = c(1000000, 800000, 600000),
  tarifas = c(5000, 4000, 3000)
)

# Ejemplo con modelo Sainsbury
result_sainsbury <- optimize_media_plan(
  soportes_df = example_data,
  FEM = 2,
  objetivo_cobertura = 50,
  presupuesto_max = 100000,
  modelo = "sainsbury"
)

# Ejemplo con modelo Binomial
result_binomial <- optimize_media_plan(
  soportes_df = example_data,
  FEM = 2,
  objetivo_cobertura = 50,
  presupuesto_max = 100000,
  modelo = "binomial"
)

# Ejemplo con modelo Canex
correlaciones <- matrix(
  c(1.000, 0.085, 0.075,
    0.085, 1.000, 0.080,
    0.075, 0.080, 1.000),
  nrow = 3,
  byrow = TRUE
)

result_canex <- optimize_media_plan(
  soportes_df = example_data,
  FEM = 2,
  objetivo_cobertura = 50,
  presupuesto_max = 100000,
  modelo = "canex",
  correlaciones = correlaciones
)

}
\references{
Aldás Manzano, J. (1998). Modelos de determinación de la cobertura y la distribución de
contactos en la planificación de medios publicitarios impresos. Tesis doctoral, Universidad de Valencia, España.
}
\seealso{
\code{\link{calc_sainsbury}} para el modelo de Sainsbury
\code{\link{calc_binomial}} para el modelo Binomial

\code{\link{calc_sainsbury}} para el modelo de Sainsbury
\code{\link{calc_binomial}} para el modelo Binomial
\code{\link{canonical_expansion_model}} para el modelo de Expansión Canónica
}
